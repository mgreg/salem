<link rel="import" href="../../bower_components/polymer/polymer.html">
<script src="../../bower_components/jquery/dist/jquery.min.js"></script>

<polymer-element name="salem-wiki-skill">
  <template>
      <p>{{ content }}</p>
  </template>

  <script>
    Polymer({
        content: "",
        publish: {
          wiki: ""
        },
        url: "http://www.salem-wiki.com/mediawiki/api.php?action=query&export&format=json&titles=",
        wikiChanged: function() {
            console.log(this.wiki);
            this.loadWikiPage(this.wiki)
        },
        loadWikiPage: function(wiki) {
            var dataUrl = this.url + wiki,
                that = this;
            console.log(dataUrl);
            if (wiki === '') {
              return;
            }
            
            $.ajax({
              type: 'GET',
              crossDomain: true,
              dataType: "jsonp",
              url: dataUrl,
              async: false,
              success: function (responseData, textStatus, jqXHR) {
                var res = responseData.query.export["*"],
                    first = res.search("{{") + 2,
                    last = res.search("}}"),
                    sk = res.substring(first,last);
                sk = sk.replace(/\&amp\;/g, "&");
                that.content = sk;
              }
            });
        }
    });

  </script>
</polymer-element>
