<link rel="import" href="../../bower_components/polymer/polymer.html">
<script src="../../bower_components/jquery/dist/jquery.min.js"></script>

<polymer-element name="salem-search-result" attributes="results">
  <template>
    
     <style>
       h5, h6 {
         margin: 0px;
         padding: 0px;
         margin: 10px;
         margin-bottom: 5px;
       }
       paper-item {
         font-size: small;
       }
       .salem-search-result {
         position: absolute;
         max-height: 350px;
         width: 100%;
         margin: 0px 10px;
         overflow: auto;
         background-color: white;
         border: 2px solid #CFD8DC;
         border-top: 0px;
         top: 65px;
       }
       .results, .sub-category {
         padding-left: 5px;
       }
       .sub-category {
         display: inline-block;
         width: 22%;
         vertical-align: top;
       }
       .hidden {
         display: none;
       }
        
    </style>
    
    <div class="salem-search-result">
        <core-selector id="selectTop" target={{$.a}} itemsSelector="paper-item" on-core-select="{{ onSelection }}">
          <form id="a">
          <div>
            <div class="{{ resultsClass }}">
              <h5>Top results</h5>
              
              <template repeat="{{ top in topItems }}">
                  <paper-item>{{ top }}</paper-item>
              </template>
              
            </div>
            <div>
              <span class="{{ foodClass }}">
                <h5>Foods</h5>
              
                <template repeat="{{ food in foods }}">
                  <paper-item class="sub-cat-element">{{ food }}</paper-item>
                </template>
              
              </span>
              <span class="{{ inspClass }}">
                <h5>Inspirational</h5>
                <template repeat="{{ insp in inspirationals }}">
                  <paper-item class="sub-cat-element">{{ insp }}</paper-item>
                </template>
              
              </span>
              <span class="{{ skillsClass }}">
                <h5>Skills</h5>
              
                <template repeat="{{ skill in skills }}">
                  <paper-item class="sub-cat-element">{{ skill }}</paper-item>
                </template>
              
              </span>
              <span class="{{ otherClass }}">
                <h5>Other</h5>
              
                <template repeat="{{ other in others }}">
                  <paper-item class="sub-cat-element">{{ other }}</paper-item>
                </template>
              
              </span>
            </div>
          </div>
              </form>
        </core-selector>
    </div>
  </template>

  <script>
    Polymer('salem-search-result',{
      results: [],
      topItems: [],
      inspirationals: [],
      foods: [],
      others: [],
      skills: [], 
      foodClass: 'hidden',
      otherClass: 'hidden',
      inspClass: 'hidden',
      skillsClass: 'hidden',
      resultsClass: 'hidden',
      resultsChanged: function(oV, nV) {
        var r = [], cats = [], food = [], insp = [], other = [], skills = [];
        for (var i = 0; i < Math.min(nV.length, 3); i++) {
          r.push(nV[i].title);
        }
        this.topItems = r;
        if (this.topItems.length) {
          this.resultsClass = "block";
        } else {
          this.resultsClass = "hidden";
        }
        
        if (nV.length < 4) {
          this.foods = food;
          this.inspirationals = insp;
          this.others = other;
        } else {
          for (i = 3; i < nV.length; i++) {
            cats = nV[i].categories.split(",");
            
            if (cats.indexOf('Food') != -1) {
              food.push(nV[i].title);
              continue;
            }
            
            if (cats.indexOf('Inspirationals') != -1) {
              insp.push(nV[i].title);
              continue;
            }
            
            if (cats.indexOf('Skills') != -1) {
              skills.push(nV[i].title);
              continue;
            }
            
            other.push(nV[i].title);
          }
        }
        
        this.foods = food;
        this.inspirationals = insp;
        this.others = other;
        this.skills = skills;
        
        if (!this.foods.length) {
          this.foodClass = "hidden";
        } else {
          this.foodClass = "sub-category";
        }
        
        if (!this.inspirationals.length) {
          this.inspClass = "hidden";
        } else {
          this.inspClass = "sub-category";
        }
        
        if (!this.skills.length) {
          this.skillsClass = "hidden";
        } else {
          this.skillsClass = "sub-category";
        }
        
        if (!this.others.length) {
          this.otherClass = "hidden";
        } else {
          this.otherClass = "sub-category";
        }
        
        $( ".sub-cat-element:parent" ).css("display", "inline-block");
        $( ".sub-category template:empty" ).parent().parent().css("display", "none");
      },
      onSelection: function(e, detail, sender) {
        var that = this;
        setTimeout( function() {that.fire("select", {msg: detail})}, 300 );
      }
    });

  </script>
</polymer-element>
